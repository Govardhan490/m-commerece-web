<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Amita' rel='stylesheet'>
</head>

<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>

<script>
    var firebaseConfig = {
        apiKey: "AIzaSyDXbuRTYEYi4K2RGArOhE5RCMZYFk7_eo4",
        authDomain: "m-commerce-7f35b.firebaseapp.com",
        databaseURL: "https://m-commerce-7f35b.firebaseio.com",
        projectId: "m-commerce-7f35b",
        storageBucket: "m-commerce-7f35b.appspot.com",
        messagingSenderId: "223447659597",
        appId: "1:223447659597:web:65e690fc71be14ac6c9804",
        measurementId: "G-K37YV1YNV6"
    };
    firebase.initializeApp(firebaseConfig);
</script>

<script>
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            $(document.body).css("display", "block");
        } else {
            window.location = "index.html";
        }
    });
</script>

<body style="background-color: rgb(255, 255, 128);display:none;">
    <div class="container-fluid pt-1">
        <div class="card">
            <div class="card-header p-3" style="text-align:center;display:inline;">
                <h1 style="font-family: Amita;"><b><i>Home Page</i></b></h1>
                <button type="button" onclick="time_out()" class="btn btn-danger" style="float: right;">Log Out</button>
                <ul class="d-flex justify-content-center row list-group list-group-horizontal" style="text-align: center;margin:auto;">
                    <li class="col-sm-3 list-group-item" id='user_name'><b>Name : </b></li>
                    <li class="col-sm-4 list-group-item" id='user_email'><b>Email : </b></li>
                    <li class="col-sm-3 list-group-item" id='user_ph'><b>Ph : </b></li>
                </ul>
            </div>
            <div class="card-body">
                <div class="alert alert-success" id="success" style="display: none;">
                    <strong>Oops!</strong> Some Error happened please refresh the page;
                </div>
                <div class="alert alert-danger" id="alert" style="display: none;">
                    <strong>Oops!</strong> Some Error happened please refresh the page;
                </div>
                <br>
                <div class="list-group">
                    <a href="add_items.html" class="list-group-item list-group-item-action" style="color: black;">Add Item</a>
                    <a href="view_item.html" class="list-group-item list-group-item-action" style="color: black;">View Items</a>
                    <a href="update_item.html" class="list-group-item list-group-item-action" style="color: black;">Update Availability of Items</a>
                </div>
            </div>
        </div>
    </div>
</body>




<script>
    function time_out() {
        if (firebase.auth().currentUser) {
            firebase.auth().signOut();
            sessionStorage.removeItem("company");
            sessionStorage.removeItem("email");
            sessionStorage.removeItem("phone");
            window.location = "index.html";
        }
    }

    $(document).ready(function() {
        if (sessionStorage.getItem("company") === null) {
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    var userId = firebase.auth().currentUser.uid;
                    var ref = firebase.database().ref('/users/Vendors/' + userId)
                    ref.on("value", function(data) {
                            var info = data.val();
                            sessionStorage.setItem("company", info.companyname);
                            sessionStorage.setItem("email", info.email);
                            sessionStorage.setItem("phone", info.phone);
                            $("#user_name").append("<b>" + info.companyname + "<b>");
                            $("#user_email").append("<b>" + info.email + "<b>");
                            $("#user_ph").append("<b>" + info.phone + "<b>");
                        },

                        function(err) {
                            console.log(err);
                        });
                } else {
                    window.location = "index.html";
                }
            });
        } else {
            $("#user_name").append("<b>" + sessionStorage.getItem("company") + "<b>");
            $("#user_email").append("<b>" + sessionStorage.getItem("email") + "<b>");
            $("#user_ph").append("<b>" + sessionStorage.getItem("phone") + "<b>");
        }
    });
</script>

</html>